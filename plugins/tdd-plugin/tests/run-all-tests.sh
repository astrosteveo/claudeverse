#!/bin/bash
# Run all TDD plugin tests

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  TDD Plugin Test Suite"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

FAILED_TESTS=()
PASSED_TESTS=()

# Test 1: Plugin structure
echo "â–¶ Running: Plugin Structure Test"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
if bash "$SCRIPT_DIR/test_plugin_structure.sh"; then
    PASSED_TESTS+=("Plugin Structure")
else
    FAILED_TESTS+=("Plugin Structure")
fi
echo ""

# Test 2: Hooks integration
echo "â–¶ Running: Hooks Integration Test"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
if bash "$SCRIPT_DIR/test_hooks_integration.sh"; then
    PASSED_TESTS+=("Hooks Integration")
else
    FAILED_TESTS+=("Hooks Integration")
fi
echo ""

# Test 3: Update CLAUDE.md script (existing test)
if [[ -f "$SCRIPT_DIR/test_update_claude_md.sh" ]]; then
    echo "â–¶ Running: Update CLAUDE.md Test"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    if bash "$SCRIPT_DIR/test_update_claude_md.sh"; then
        PASSED_TESTS+=("Update CLAUDE.md")
    else
        FAILED_TESTS+=("Update CLAUDE.md")
    fi
    echo ""
fi

# Summary
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  Test Results"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "âœ… Passed: ${#PASSED_TESTS[@]}"
for test in "${PASSED_TESTS[@]}"; do
    echo "   - $test"
done
echo ""

if [[ ${#FAILED_TESTS[@]} -gt 0 ]]; then
    echo "âŒ Failed: ${#FAILED_TESTS[@]}"
    for test in "${FAILED_TESTS[@]}"; do
        echo "   - $test"
    done
    echo ""
    exit 1
else
    echo "ğŸ‰ All tests passed!"
    echo ""
    exit 0
fi
